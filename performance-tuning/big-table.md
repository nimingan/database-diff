# 大表及大事务

## 大表

* 记录行数巨大，单表超过千万行
* 表数据文件巨大，表数据文件超过10G

### 影响

* 慢查询：很难在一定的时间内过滤出所需要的数据
* 建立索引需要很长的时间
    * mysql版本<5.5 建立索引会锁表
    * mysql版本>=5.5 虽然不会锁表但会引起主从延迟
* 修改表结构需要长时间锁表
    * 会造成长时间的主从延迟
    * 影响正常的数据操作

### 如何解决
* 分库分表把一张大表分成多个小表
    * 难点
        * 分表主键的选择
        * 分表后跨分区数据的查询和统计
* 大表的历史数据归档
    * 作用
        * 减少对前后端业务的影响
    * 难点
        * 归档时间点的选择
        * 如何进行归档操作

## 大事务

* 运行时间比较长，操作的数据比较多的事务

### 影响

* 锁定太多的数据，造成大量的阻塞和锁超时
* 回滚时所需时间比较长
* 执行时间长，容易造成主从延迟

### 如何解决

* 避免处理太多的数据
* 移出不必要在事务中的SELECT操作